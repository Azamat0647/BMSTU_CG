SRC_DIR := .
BUILD_DIR := ./build
OUT_DIR := ./out
APP_NAME := app
GENERATOR_NAME := "Unix Makefiles"
CMAKE_RELEASE_FLAGS := -D CMAKE_BUILD_TYPE=release
UNIT_TEST_REPORT_NAME := report-unittesting

build_release:
	cmake $(CMAKE_RELEASE_FLAGS) -S $(SRC_DIR) -B $(BUILD_DIR) -G $(GENERATOR_NAME)
	cmake --build $(BUILD_DIR)

release: build_release
	cmake --install $(BUILD_DIR) --prefix $(OUT_DIR) --config Release

run: release
	$(OUT_DIR)/$(APP_NAME)

$(UNIT_TEST_REPORT_NAME)-latest.txt:
	echo "total code coverage: 0.00%" > $(UNIT_TEST_REPORT_NAME)-latest.txt
	
format:
	find ./app/src -regex '.*\.\(cpp\|hpp\|cu\|cuh\|c\|h\)' -exec clang-format --style=Microsoft -i {} \;

checkall:
	lizard -Eduplicate

saveolds:
	cp $(UNIT_TEST_REPORT_NAME)-latest.txt $(UNIT_TEST_REPORT_NAME)-old.txt

clean:
	rm -rf $(BUILD_DIR)
	rm -rf $(OUT_DIR)
	rm -f *.txt.user
	rm -f *-latest.txt
